{"version":3,"file":"main-HYu2txnq.js","sources":["../../src/js/modules/logger.js","../../src/js/modules/saveManager.js","../../src/js/modules/uiManager.js","../../src/js/modules/selectionManager.js","../../src/js/modules/temperatureManager.js","../../src/js/modules/app.js","../../src/js/main.js"],"sourcesContent":["// Simple logger implementation\nexport class Logger {\n    constructor() {\n        this.isLogging = false;\n        this.originalConsole = {\n            log: console.log,\n            error: console.error,\n            warn: console.warn,\n            info: console.info,\n            debug: console.debug\n        };\n        \n        // Set up broadcast channel for diagnostics\n        try {\n            this.diagChannel = new BroadcastChannel('evolution-sim-diag');\n            this.broadcastLog('Logger initialized', 'info');\n        } catch (error) {\n            console.error('Failed to initialize broadcast channel:', error);\n        }\n        \n        // Bind methods\n        this.log = this._log.bind(this, 'log');\n        this.error = this._log.bind(this, 'error');\n        this.warn = this._log.bind(this, 'warn');\n        this.info = this._log.bind(this, 'info');\n        this.debug = this._log.bind(this, 'debug');\n        \n        // Setup error handlers\n        this._setupErrorHandlers();\n    }\n    \n    _log(level, ...args) {\n        if (this.isLogging) return;\n        this.isLogging = true;\n        \n        try {\n            // Format the message\n            const message = args.map(arg => {\n                if (arg instanceof Error) return arg.stack || arg.message;\n                if (arg && typeof arg === 'object') {\n                    try { return JSON.stringify(arg, null, 2); }\n                    catch (e) { return String(arg); }\n                }\n                return String(arg);\n            }).join(' ');\n            \n            // Log to console\n            const logMethod = this.originalConsole[level] || this.originalConsole.log;\n            logMethod(...args);\n            \n            // Broadcast to diagnostic console\n            this.broadcastLog(message, level);\n            \n            // Log to UI if available\n            this._logToUI(args, level);\n        } catch (e) {\n            this.originalConsole.error('Logger error:', e);\n            this.broadcastLog(`Logger error: ${e.message}`, 'error');\n        } finally {\n            this.isLogging = false;\n        }\n    }\n    \n    _logToUI(args, level) {\n        try {\n            const logElement = document.getElementById('log');\n            if (!logElement) return;\n            \n            const message = args.map(arg => {\n                if (arg instanceof Error) return arg.stack || arg.message;\n                if (arg && typeof arg === 'object') {\n                    try { return JSON.stringify(arg, null, 2); }\n                    catch (e) { return String(arg); }\n                }\n                return String(arg);\n            }).join(' ');\n            \n            const now = new Date();\n            const logEntry = document.createElement('div');\n            logEntry.className = `log-entry log-${level}`;\n            \n            const time = document.createElement('span');\n            time.className = 'log-time';\n            time.textContent = `${now.toISOString().substr(11, 8)} `;\n            \n            const msg = document.createElement('span');\n            msg.className = 'log-message';\n            msg.textContent = message;\n            \n            logEntry.appendChild(time);\n            logEntry.appendChild(msg);\n            \n            logElement.prepend(logEntry);\n            \n            // Limit log entries\n            const maxLogs = 1000;\n            if (logElement.children.length > maxLogs) {\n                logElement.removeChild(logElement.lastChild);\n            }\n        } catch (e) {\n            this.originalConsole.error('Error in UI logger:', e);\n        }\n    }\n    \n    _setupErrorHandlers() {\n        // Handle uncaught errors\n        window.addEventListener('error', (event) => {\n            this.error('Uncaught Error:', event.error || event.message);\n            event.preventDefault();\n        });\n        \n        // Handle unhandled promise rejections\n        window.addEventListener('unhandledrejection', (event) => {\n            this.error('Unhandled Promise Rejection:', event.reason);\n            event.preventDefault();\n        });\n    }\n    \n    broadcastLog(message, type = 'info') {\n        if (!this.diagChannel) return;\n        \n        try {\n            // Stringify the message if it's an object\n            const messageStr = typeof message === 'object' \n                ? JSON.stringify(message, null, 2) \n                : String(message);\n                \n            this.diagChannel.postMessage({\n                type: 'log',\n                data: { \n                    message: messageStr,\n                    type: type,\n                    timestamp: new Date().toISOString()\n                }\n            });\n        } catch (error) {\n            this.originalConsole.error('Failed to broadcast log:', error);\n        }\n    }\n}\n\n// Export a singleton instance\nexport const logger = new Logger();\n","import { logger } from './logger.js';\n\n/**\n * SaveManager handles all save/load operations for the game\n */\nclass SaveManager {\n    constructor() {\n        this.STORAGE_KEY = 'evolution_sim_saves';\n        this.saves = this._loadSaves();\n    }\n\n    /**\n     * Loads all saves from local storage\n     * @private\n     */\n    _loadSaves() {\n        try {\n            const savesJson = localStorage.getItem(this.STORAGE_KEY);\n            if (!savesJson) return [];\n            \n            const saves = JSON.parse(savesJson);\n            // Ensure all saves have required fields\n            return saves.map(save => ({\n                id: save.id || this._generateId(),\n                name: save.name || 'Unnamed Save',\n                timestamp: save.timestamp || Date.now(),\n                gameState: save.gameState || {},\n                metadata: {\n                    turnCount: save.metadata?.turnCount || 0,\n                    creatureCount: save.metadata?.creatureCount || 0,\n                    createdAt: save.metadata?.createdAt || Date.now(),\n                    lastPlayed: save.metadata?.lastPlayed || Date.now(),\n                    ...save.metadata\n                },\n                version: save.version || '1.0.0'\n            }));\n        } catch (error) {\n            logger.error('Error loading saves:', error);\n            return [];\n        }\n    }\n\n    /**\n     * Saves all game states to local storage\n     * @private\n     */\n    _saveSaves() {\n        try {\n            localStorage.setItem(this.STORAGE_KEY, JSON.stringify(this.saves));\n            return true;\n        } catch (error) {\n            logger.error('Error saving game:', error);\n            return false;\n        }\n    }\n\n    /**\n     * Generates a unique ID for a new save\n     * @private\n     */\n    _generateId() {\n        return 'save_' + Math.random().toString(36).substr(2, 9);\n    }\n\n    /**\n     * Gets all saved games\n     * @returns {Array} Array of saved games\n     */\n    getSaves() {\n        return [...this.saves].sort((a, b) => b.timestamp - a.timestamp);\n    }\n\n    /**\n     * Gets a specific save by ID\n     * @param {string} id - The save ID\n     * @returns {Object|null} The save object or null if not found\n     */\n    getSave(id) {\n        return this.saves.find(save => save.id === id) || null;\n    }\n\n    /**\n     * Creates a new save\n     * @param {Object} gameState - The game state to save\n     * @param {string} name - The name of the save\n     * @returns {Object} The created save object\n     */\n    createSave(gameState, name = 'New Save') {\n        const save = {\n            id: this._generateId(),\n            name: name.trim() || 'Unnamed Save',\n            timestamp: Date.now(),\n            gameState: { ...gameState },\n            metadata: {\n                turnCount: gameState.turnCount || 0,\n                creatureCount: gameState.creatures?.length || 0,\n                createdAt: Date.now(),\n                lastPlayed: Date.now()\n            },\n            version: '1.0.0'\n        };\n\n        this.saves.push(save);\n        this._saveSaves();\n        return save;\n    }\n\n    /**\n     * Updates an existing save\n     * @param {string} id - The save ID to update\n     * @param {Object} updates - The updates to apply\n     * @returns {Object|null} The updated save or null if not found\n     */\n    updateSave(id, updates) {\n        const saveIndex = this.saves.findIndex(save => save.id === id);\n        if (saveIndex === -1) return null;\n\n        const updatedSave = {\n            ...this.saves[saveIndex],\n            ...updates,\n            timestamp: Date.now(),\n            metadata: {\n                ...this.saves[saveIndex].metadata,\n                ...(updates.metadata || {}),\n                lastPlayed: Date.now()\n            }\n        };\n\n        this.saves[saveIndex] = updatedSave;\n        this._saveSaves();\n        return updatedSave;\n    }\n\n    /**\n     * Deletes a save\n     * @param {string} id - The save ID to delete\n     * @returns {boolean} True if deleted, false if not found\n     */\n    deleteSave(id) {\n        const initialLength = this.saves.length;\n        this.saves = this.saves.filter(save => save.id !== id);\n        \n        if (this.saves.length < initialLength) {\n            this._saveSaves();\n            return true;\n        }\n        return false;\n    }\n\n    /**\n     * Saves the current game state\n     * @param {Object} gameState - The current game state\n     * @param {string} [name] - Optional save name (for new saves)\n     * @param {string} [saveId] - Optional save ID (for updates)\n     * @returns {Object} The saved game state\n     */\n    saveGame(gameState, name, saveId = null) {\n        if (saveId) {\n            // Update existing save\n            return this.updateSave(saveId, {\n                gameState,\n                metadata: {\n                    turnCount: gameState.turnCount || 0,\n                    creatureCount: gameState.creatures?.length || 0\n                }\n            });\n        } else {\n            // Create new save\n            return this.createSave(gameState, name);\n        }\n    }\n\n    /**\n     * Loads a saved game state\n     * @param {string} id - The save ID to load\n     * @returns {Object|null} The loaded game state or null if not found\n     */\n    loadGame(id) {\n        const save = this.getSave(id);\n        if (!save) return null;\n\n        // Update last played timestamp\n        this.updateSave(id, { \n            metadata: { lastPlayed: Date.now() } \n        });\n\n        // Return both the game state and the save metadata\n        return {\n            ...save.gameState,\n            // Include save metadata in the game state\n            saveId: save.id,\n            saveName: save.name,\n            // Include other metadata that might be useful\n            metadata: {\n                ...(save.gameState.metadata || {}),\n                ...save.metadata\n            }\n        };\n    }\n\n    /**\n     * Exports all saves as a JSON string\n     * @returns {string} JSON string of all saves\n     */\n    exportSaves() {\n        return JSON.stringify(this.saves, null, 2);\n    }\n\n    /**\n     * Imports saves from a JSON string\n     * @param {string} jsonString - JSON string of saves to import\n     * @param {boolean} merge - Whether to merge with existing saves\n     * @returns {boolean} True if import was successful\n     */\n    importSaves(jsonString, merge = true) {\n        try {\n            const importedSaves = JSON.parse(jsonString);\n            \n            if (!Array.isArray(importedSaves)) {\n                throw new Error('Invalid save data format');\n            }\n\n            if (merge) {\n                // Create a map of existing saves by ID\n                const existingSaves = new Map(this.saves.map(save => [save.id, save]));\n                \n                // Merge with existing saves, preferring imported ones\n                importedSaves.forEach(save => {\n                    existingSaves.set(save.id, {\n                        ...(existingSaves.get(save.id) || {}),\n                        ...save,\n                        // Always use the imported timestamp to maintain save order\n                        timestamp: save.timestamp || Date.now()\n                    });\n                });\n                \n                this.saves = Array.from(existingSaves.values());\n            } else {\n                this.saves = importedSaves;\n            }\n\n            this._saveSaves();\n            return true;\n        } catch (error) {\n            logger.error('Error importing saves:', error);\n            return false;\n        }\n    }\n}\n\n// Export a singleton instance\nexport const saveManager = new SaveManager();\n","import { logger } from './logger.js';\n\nexport class UIManager {\n    constructor(app) {\n        this.app = app;\n        this.elements = {};\n        this.fps = 0;\n        this.lastTime = performance.now();\n        this.frames = 0;\n        this.simulationTime = 0;\n        this.lastUpdateTime = 0;\n        this.debugOverlay = null;\n        \n        // Store saveManager reference with error handling\n        if (app && app.saveManager) {\n            this.saveManager = app.saveManager;\n        } else {\n            console.error('SaveManager not available in UIManager constructor');\n            // Create a mock saveManager with minimal functionality to prevent errors\n            this.saveManager = {\n                getSaves: () => {\n                    console.warn('Using mock saveManager - no saves available');\n                    return [];\n                },\n                saveGame: () => {\n                    console.warn('Using mock saveManager - save failed');\n                    return null;\n                },\n                loadGame: () => {\n                    console.warn('Using mock saveManager - load failed');\n                    return null;\n                },\n                deleteSave: () => {\n                    console.warn('Using mock saveManager - delete failed');\n                    return false;\n                }\n            };\n        }\n    }\n\n    initialize() {\n        this.initializeElements();\n        this.setupButtonListeners();\n        this.createDebugOverlay();\n        logger.log('UI Manager initialized');\n    }\n    \n    /**\n     * Creates the debug overlay element\n     */\n    createDebugOverlay() {\n        this.debugOverlay = document.createElement('div');\n        this.debugOverlay.id = 'debug-overlay';\n        this.debugOverlay.style.position = 'fixed';\n        this.debugOverlay.style.top = '10px';\n        this.debugOverlay.style.left = '10px';\n        this.debugOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';\n        this.debugOverlay.style.color = '#fff';\n        this.debugOverlay.style.padding = '8px 12px';\n        this.debugOverlay.style.borderRadius = '4px';\n        this.debugOverlay.style.fontFamily = 'monospace';\n        this.debugOverlay.style.fontSize = '14px';\n        this.debugOverlay.style.zIndex = '1000';\n        this.debugOverlay.style.pointerEvents = 'none';\n        this.debugOverlay.style.userSelect = 'none';\n        this.debugOverlay.style.lineHeight = '1.5';\n        this.debugOverlay.innerHTML = 'FPS: 0\\nTime: 0.0s\\nTemp: N/A';\n        \n        document.body.appendChild(this.debugOverlay);\n    }\n    \n    /**\n     * Updates the debug overlay with current stats\n     * @param {number} time - Current timestamp\n     * @param {Object} cellInfo - Information about the selected cell\n     */\n    updateDebugOverlay(time, cellInfo = null) {\n        if (!this.debugOverlay) return;\n        \n        // Calculate FPS\n        this.frames++;\n        if (time - this.lastTime >= 1000) {\n            this.fps = Math.round((this.frames * 1000) / (time - this.lastTime));\n            this.frames = 0;\n            this.lastTime = time;\n        }\n        \n        // Update simulation time (in seconds with 1 decimal place)\n        if (this.app && this.app.isRunning && !this.app.isPaused) {\n            const delta = (time - this.lastUpdateTime) / 1000; // Convert to seconds\n            this.simulationTime += delta;\n        }\n        this.lastUpdateTime = time;\n        \n        // Get temperature or show N/A if no cell is selected\n        let infoText = 'No cell selected';\n        if (cellInfo && cellInfo.temp !== undefined) {\n            infoText = `Temp: ${cellInfo.temp.toFixed(1)}Â°C`;\n        }\n        \n        // Update overlay content\n        this.debugOverlay.innerHTML = `\n            FPS: ${this.fps}<br>\n            Time: ${this.simulationTime.toFixed(1)}s<br>\n            ${infoText}\n        `;\n    }\n\n    initializeElements() {\n        this.elements = {\n            gameContainer: document.getElementById('game-container'),\n            mainMenu: document.getElementById('main-menu'),\n            newGameBtn: document.getElementById('new-game-btn'),\n            loadGameBtn: document.getElementById('load-game-btn'),\n            settingsBtn: document.getElementById('settings-btn'),\n            pauseMenu: document.getElementById('pause-menu'),\n            resumeBtn: document.getElementById('resume-btn'),\n            saveGameBtn: document.getElementById('save-game-btn'),\n            saveQuitBtn: document.getElementById('save-quit-btn'),\n            settingsMenuBtn: document.getElementById('settings-menu-btn'),\n            quitToMenuBtn: document.getElementById('quit-to-menu-btn')\n        };\n        \n        const newGameModal = document.getElementById('new-game-modal');\n        this.elements.newGameModal = newGameModal;\n        \n        // Add other elements\n        Object.assign(this.elements, {\n            saveNameInput: document.getElementById('save-name'),\n            closeNewGameBtn: document.getElementById('close-new-game'),\n            cancelNewGameBtn: document.getElementById('cancel-new-game'),\n            confirmNewGameBtn: document.getElementById('confirm-new-game')\n        });\n    }\n\n    setupButtonListeners() {\n        const { \n            newGameBtn, \n            loadGameBtn, \n            settingsBtn,\n            resumeBtn,\n            saveGameBtn,\n            saveQuitBtn,\n            settingsMenuBtn,\n            quitToMenuBtn,\n            newGameModal,\n            closeNewGameBtn,\n            cancelNewGameBtn,\n            confirmNewGameBtn,\n            saveNameInput\n        } = this.elements;\n        \n        // New game modal handlers\n        if (closeNewGameBtn) {\n            closeNewGameBtn.addEventListener('click', () => this.hideNewGameModal());\n        }\n        \n        if (cancelNewGameBtn) {\n            cancelNewGameBtn.addEventListener('click', () => this.hideNewGameModal());\n        }\n        \n        if (confirmNewGameBtn) {\n            confirmNewGameBtn.addEventListener('click', () => this.app.confirmNewGame());\n        }\n        \n        // Close modal when clicking outside the content\n        if (newGameModal) {\n            newGameModal.addEventListener('click', (e) => {\n                if (e.target === newGameModal) {\n                    this.hideNewGameModal();\n                }\n            });\n            \n            // Handle keyboard events for the new game modal\n            if (saveNameInput) {\n                // Handle Enter key in the save name input\n                saveNameInput.addEventListener('keypress', (e) => {\n                    if (e.key === 'Enter') {\n                        this.app.confirmNewGame();\n                    }\n                });\n                \n                // Handle ESC key to close the modal\n                saveNameInput.addEventListener('keydown', (e) => {\n                    if (e.key === 'Escape') {\n                        this.hideNewGameModal();\n                    }\n                });\n            }\n        }\n\n        // Set up button event listeners\n        // Main menu buttons\n        if (newGameBtn) {\n            newGameBtn.addEventListener('click', () => this.app.startNewGame());\n        }\n        \n        if (loadGameBtn) {\n            loadGameBtn.addEventListener('click', () => this.app.showSaveManager());\n        }\n        \n        if (settingsBtn) {\n            settingsBtn.addEventListener('click', () => this.app.showSettings());\n        }\n        \n        // Pause menu buttons\n        if (resumeBtn) {\n            resumeBtn.addEventListener('click', () => this.app.onResumeClick());\n        }\n        \n        if (saveGameBtn) {\n            saveGameBtn.addEventListener('click', () => this.app.onSaveGameClick());\n        }\n        \n        if (saveQuitBtn) {\n            saveQuitBtn.addEventListener('click', () => this.app.onSaveAndQuitClick());\n        }\n        \n        if (settingsMenuBtn) {\n            settingsMenuBtn.addEventListener('click', () => this.app.showSettings());\n        }\n        \n        if (quitToMenuBtn) {\n            quitToMenuBtn.addEventListener('click', () => this.app.onQuitToMenuClick());\n        }\n        \n        // Add keyboard event listener for ESC key\n        document.addEventListener('keydown', (event) => {\n            if (event.key === 'Escape' && this.app.isRunning) {\n                this.app.togglePause();\n                event.preventDefault(); // Prevent default ESC behavior\n            }\n        });\n    }\n\n    // UI State Management\n    showMainMenu() {\n        if (this.elements.mainMenu) this.elements.mainMenu.style.display = 'flex';\n        if (this.elements.pauseMenu) this.elements.pauseMenu.style.display = 'none';\n    }\n\n    hideMainMenu() {\n        if (this.elements.mainMenu) this.elements.mainMenu.style.display = 'none';\n    }\n\n    showPauseMenu() {\n        if (this.elements.pauseMenu) {\n            this.elements.pauseMenu.classList.remove('hidden');\n            this.elements.pauseMenu.style.display = 'flex';\n            this.elements.pauseMenu.style.visibility = 'visible';\n            this.elements.pauseMenu.style.opacity = '1';\n        } else {\n            console.error('Pause menu element not found in UIManager');\n            console.error('Available elements in the DOM with IDs:', \n                Array.from(document.querySelectorAll('[id]')).map(el => el.id));\n        }\n    }\n\n    hidePauseMenu() {\n        if (this.elements.pauseMenu) {\n            this.elements.pauseMenu.style.display = 'none';\n            this.elements.pauseMenu.classList.add('hidden');\n        }\n    }\n\n    /**\n     * Shows a confirmation dialog before performing an action\n     * @param {Object} save - The save object to be deleted\n     * @param {Function} onConfirm - Callback function when user confirms\n     */\n    showConfirmationModal(save, onConfirm) {\n        const confirmationModal = document.getElementById('confirmation-modal');\n        const message = document.getElementById('confirmation-message');\n        const confirmBtn = document.getElementById('confirm-delete');\n        const cancelBtn = document.getElementById('cancel-delete');\n        const closeBtn = document.getElementById('close-confirmation');\n        \n        if (!confirmationModal || !message || !confirmBtn || !cancelBtn || !closeBtn) {\n            console.error('Confirmation modal elements not found');\n            return;\n        }\n        \n        // Set the confirmation message\n        message.textContent = `Are you sure you want to delete \"${save.name || 'this save'}\"?`;\n        \n        // Show the modal\n        confirmationModal.classList.remove('hidden');\n        confirmationModal.style.display = 'flex';\n        confirmationModal.style.opacity = '1';\n        confirmationModal.style.visibility = 'visible';\n        \n        // Set up event listeners\n        const hideModal = () => {\n            confirmationModal.style.opacity = '0';\n            confirmationModal.style.visibility = 'hidden';\n            setTimeout(() => {\n                confirmationModal.style.display = 'none';\n            }, 300);\n            \n            // Clean up event listeners\n            confirmBtn.onclick = null;\n            cancelBtn.onclick = null;\n            closeBtn.onclick = null;\n            confirmationModal.onclick = null;\n        };\n        \n        // Handle confirm button click\n        confirmBtn.onclick = () => {\n            if (typeof onConfirm === 'function') {\n                onConfirm();\n            }\n            hideModal();\n        };\n        \n        // Handle cancel and close button clicks\n        const cancelHandler = () => hideModal();\n        cancelBtn.onclick = cancelHandler;\n        closeBtn.onclick = cancelHandler;\n        \n        // Close when clicking outside the modal content\n        confirmationModal.onclick = (e) => {\n            if (e.target === confirmationModal) {\n                hideModal();\n            }\n        };\n    }\n\n    showNewGameModal() {\n        // Try to find the element again in case it wasn't found during initialization\n        if (!this.elements.newGameModal) {\n            this.elements.newGameModal = document.getElementById('new-game-modal');\n        }\n        \n        if (this.elements.newGameModal) {\n            // Remove the 'hidden' class if it exists\n            this.elements.newGameModal.classList.remove('hidden');\n            \n            // Set initial styles for fade-in effect\n            this.elements.newGameModal.style.display = 'flex';\n            this.elements.newGameModal.style.visibility = 'hidden';\n            this.elements.newGameModal.style.opacity = '0';\n            \n            // Force reflow to ensure the initial styles are applied\n            void this.elements.newGameModal.offsetHeight;\n            \n            // Fade in the modal\n            this.elements.newGameModal.style.visibility = 'visible';\n            this.elements.newGameModal.style.opacity = '1';\n            \n            // Add keydown event listener for ESC key\n            const handleKeyDown = (e) => {\n                if (e.key === 'Escape') {\n                    this.hideNewGameModal();\n                }\n            };\n            \n            // Add the event listener\n            document.addEventListener('keydown', handleKeyDown);\n            \n            // Store the handler so we can remove it later\n            this.newGameModalKeyHandler = handleKeyDown;\n            \n            // Focus the input field with a small delay to ensure it's visible\n            if (this.elements.saveNameInput) {\n                // Select any existing text in the input\n                this.elements.saveNameInput.select();\n                // Set focus\n                setTimeout(() => {\n                    this.elements.saveNameInput.focus();\n                }, 50);\n            }\n        } else {\n            console.error('New game modal element not found in UIManager');\n            console.error('Available elements in the DOM with IDs:', \n                Array.from(document.querySelectorAll('[id]')).map(el => el.id));\n        }\n    }\n\n    hideNewGameModal() {\n        if (this.elements.newGameModal) {\n            this.elements.newGameModal.style.display = 'none';\n            \n            // Remove the ESC key event listener if it exists\n            if (this.newGameModalKeyHandler) {\n                document.removeEventListener('keydown', this.newGameModalKeyHandler);\n                this.newGameModalKeyHandler = null;\n            }\n            \n            // Clear the input field when hiding the modal\n            if (this.elements.saveNameInput) {\n                this.elements.saveNameInput.value = '';\n            }\n        }\n    }\n\n    getSaveName() {\n        return this.elements.saveNameInput ? this.elements.saveNameInput.value.trim() : '';\n    }\n\n    // Save Manager UI Methods\n    showSaveManager() {\n        const saveManagerModal = document.getElementById('save-manager-modal');\n        const closeBtn = document.getElementById('close-save-manager');\n        \n        if (!saveManagerModal || !closeBtn) {\n            console.error('Save manager modal elements not found');\n            return;\n        }\n        \n        // Show the modal\n        saveManagerModal.classList.remove('hidden');\n        saveManagerModal.style.display = 'flex';\n        saveManagerModal.style.opacity = '1';\n        saveManagerModal.style.visibility = 'visible';\n        \n        // Prevent scrolling when modal is open\n        document.body.style.overflow = 'hidden';\n        \n        // Add ESC key handler\n        const handleKeyDown = (e) => {\n            if (e.key === 'Escape') {\n                this.hideSaveManager();\n            }\n        };\n        \n        // Add event listeners\n        document.addEventListener('keydown', handleKeyDown);\n        closeBtn.onclick = () => this.hideSaveManager();\n        \n        // Store the keydown handler for cleanup\n        saveManagerModal._keyDownHandler = handleKeyDown;\n        \n        // Load and display saved games\n        this.refreshSaveList();\n    }\n    \n    hideSaveManager() {\n        const saveManagerModal = document.getElementById('save-manager-modal');\n        if (!saveManagerModal) return;\n        \n        // Remove the keydown event listener if it exists\n        if (saveManagerModal._keyDownHandler) {\n            document.removeEventListener('keydown', saveManagerModal._keyDownHandler);\n            delete saveManagerModal._keyDownHandler;\n        }\n        \n        // Remove the close button event listener\n        const closeBtn = document.getElementById('close-save-manager');\n        if (closeBtn) {\n            closeBtn.onclick = null;\n        }\n        \n        // Hide the modal with animation\n        saveManagerModal.style.opacity = '0';\n        saveManagerModal.style.visibility = 'hidden';\n        \n        // Reset body overflow\n        document.body.style.overflow = '';\n        \n        // Remove the modal from the DOM after the animation completes\n        setTimeout(() => {\n            saveManagerModal.style.display = 'none';\n        }, 300);\n    }\n    \n    refreshSaveList() {\n        const savesList = document.getElementById('saves-list');\n        if (!savesList) {\n            logger.error('Saves list element not found');\n            return;\n        }\n        \n        // Clear existing list\n        savesList.innerHTML = '';\n        \n        try {\n            // Get all saves from save manager\n            const saves = this.saveManager.getSaves();\n            \n            if (!saves || !Array.isArray(saves)) {\n                throw new Error('Invalid saves data received');\n            }\n            \n            if (saves.length === 0) {\n                const noSaves = document.createElement('div');\n                noSaves.className = 'no-saves';\n                noSaves.textContent = 'No saved games found';\n                savesList.appendChild(noSaves);\n                return;\n            }\n            \n            // Add each save to the list\n            saves.forEach(save => {\n                try {\n                    const saveItem = document.createElement('div');\n                    saveItem.className = 'save-item';\n                    saveItem.dataset.saveId = save.id;\n                    \n                    // Format the date\n                    const saveDate = new Date(save.timestamp);\n                    const formattedDate = saveDate.toLocaleString();\n                    \n                    saveItem.innerHTML = `\n                        <div class=\"save-info\">\n                            <div class=\"save-name\">${save.name || 'Unnamed Save'}</div>\n                            <div class=\"save-meta\">\n                                <span class=\"save-date\">${formattedDate}</span>\n                                <span class=\"save-turn\">Turn: ${save.metadata?.turnCount || 0}</span>\n                                <span class=\"save-creatures\">Creatures: ${save.metadata?.creatureCount || 0}</span>\n                            </div>\n                        </div>\n                        <div class=\"save-actions\">\n                            <button class=\"btn btn-load\">Load</button>\n                            <button class=\"btn btn-delete\">Delete</button>\n                        </div>\n                    `;\n\n                    // Add click handler to load the game\n                    const loadBtn = saveItem.querySelector('.btn-load');\n                    if (loadBtn) {\n                        loadBtn.addEventListener('click', (e) => {\n                            e.stopPropagation();\n                            this.app.loadGame(save.id);\n                        });\n                    }\n                    \n                    // Add click handler to delete the save\n                    const deleteBtn = saveItem.querySelector('.btn-delete');\n                    if (deleteBtn) {\n                        deleteBtn.addEventListener('click', (e) => {\n                            e.stopPropagation();\n                            this.showConfirmationModal(save, () => {\n                                if (this.saveManager) {\n                                    this.saveManager.deleteSave(save.id);\n                                    this.refreshSaveList();\n                                } else {\n                                    console.error('Save manager not available');\n                                }\n                            });\n                        });\n                    }\n                    \n                    savesList.appendChild(saveItem);\n                } catch (error) {\n                    console.error('Error creating save item:', error);\n                }\n            });\n        } catch (error) {\n            console.error('Error loading saves:', error);\n            const errorMsg = document.createElement('div');\n            errorMsg.className = 'error-message';\n            errorMsg.textContent = 'Error loading saved games';\n            savesList.appendChild(errorMsg);\n        }\n    }\n    \n    // Notification System\n    showNotification(message, duration = 3000) {\n        // Create notification element if it doesn't exist\n        let notification = document.getElementById('notification');\n        if (!notification) {\n            notification = document.createElement('div');\n            notification.id = 'notification';\n            notification.style.position = 'fixed';\n            notification.style.bottom = '20px';\n            notification.style.left = '50%';\n            notification.style.transform = 'translateX(-50%)';\n            notification.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';\n            notification.style.color = 'white';\n            notification.style.padding = '10px 20px';\n            notification.style.borderRadius = '4px';\n            notification.style.zIndex = '1000';\n            notification.style.transition = 'opacity 0.3s ease-in-out';\n            notification.style.opacity = '0';\n            document.body.appendChild(notification);\n        }\n        \n        // Set message and show\n        notification.textContent = message;\n        notification.style.opacity = '1';\n        \n        // Auto-hide after duration\n        clearTimeout(notification._hideTimeout);\n        notification._hideTimeout = setTimeout(() => {\n            notification.style.opacity = '0';\n        }, duration);\n    }\n    \n    // Pause Menu Functions\n    onResumeClick() {\n        this.app.resumeSimulation();\n    }\n    \n    async onSaveAndQuitClick() {\n        logger.log('Save & Quit clicked');\n        \n        try {\n            // First save the game\n            await this.app.onSaveGameClick();\n            \n            // Small delay to show the save notification\n            await new Promise(resolve => setTimeout(resolve, 500));\n            \n            // Then quit to menu\n            this.onQuitToMenuClick();\n        } catch (error) {\n            logger.error('Error during save & quit:', error);\n            this.showNotification('Error saving game. Changes may not be saved.');\n        }\n    }\n    \n    async onQuitToMenuClick() {\n        try {\n            logger.log('Quitting to main menu...');\n            \n            // Reset the simulation\n            await this.app.resetSimulation();\n            \n            // Show main menu and hide game container\n            this.showMainMenu();\n            \n            // Hide the game container\n            if (this.elements.gameContainer) {\n                this.elements.gameContainer.classList.add('hidden');\n            }\n            \n            // Reset states\n            this.app.isRunning = false;\n            this.app.isPaused = false;\n            \n            logger.log('Successfully returned to main menu');\n        } catch (error) {\n            logger.error('Error during quit to menu:', error);\n            throw error;\n        }\n    }\n    \n    // Game State UI Functions\n    togglePause() {\n        if (!this.app.isRunning) return;\n        \n        this.app.isPaused = !this.app.isPaused;\n        \n        if (this.app.isPaused) {\n            // Pause the simulation\n            if (window.Module) {\n                if (typeof window.Module._emscripten_pause_main_loop === 'function') {\n                    window.Module._emscripten_pause_main_loop();\n                } else if (window.Module.asm && window.Module.asm._emscripten_pause_main_loop) {\n                    window.Module.asm._emscripten_pause_main_loop();\n                }\n            }\n            \n            // Show pause menu\n            this.showPauseMenu();\n            \n            logger.log('Simulation paused');\n        } else {\n            this.resumeSimulation();\n        }\n    }\n    \n    resumeSimulation() {\n        if (window.Module) {\n            if (typeof window.Module._emscripten_resume_main_loop === 'function') {\n                window.Module._emscripten_resume_main_loop();\n            } else if (window.Module.asm && window.Module.asm._emscripten_resume_main_loop) {\n                window.Module.asm._emscripten_resume_main_loop();\n            }\n        }\n        \n        // Hide pause menu\n        this.hidePauseMenu();\n        \n        this.app.isPaused = false;\n        logger.log('Simulation resumed');\n    }\n}\n","import { logger } from './logger.js';\n\nexport class SelectionManager {\n    constructor() {\n        this.selectedCell = null;\n        this.hoveredCell = null;\n        this.isDragging = false;\n        this.lastProcessedCell = null; // Track last processed cell during drag\n        this.tooltip = this.createTooltip();\n        this.cellSize = 20; // Default, will be updated\n        this.canvas = null;\n        this.brushSize = 0; // 0 means single cell, 2 means 5x5 (radius of 2 in each direction)\n        this.isAdmin = false; // Track admin mode state\n        this.tempAdjustDirection = 1; // 1 for increase, -1 for decrease\n        this.dragButton = null; // Track which button started the drag\n    }\n\n    /**\n     * Initialize the selection manager with canvas reference\n     * @param {HTMLCanvasElement} canvas - The canvas element\n     * @param {number} cellSize - Size of each cell in pixels\n     */\n    init(canvas, cellSize) {\n        // Store the canvas and cell size\n        this.canvas = canvas;\n        this.cellSize = cellSize;\n        \n        // Initialize event handlers object if it doesn't exist\n        if (!this._eventHandlers) {\n            this._eventHandlers = {};\n        }\n        \n        // Remove any existing event listeners if reinitializing\n        if (this._currentCanvas) {\n            if (this._eventHandlers.mouseMove) {\n                this._currentCanvas.removeEventListener('mousemove', this._eventHandlers.mouseMove);\n            }\n            if (this._eventHandlers.mouseDown) {\n                this._currentCanvas.removeEventListener('mousedown', this._eventHandlers.mouseDown);\n            }\n            if (this._eventHandlers.mouseUp) {\n                this._currentCanvas.removeEventListener('mouseup', this._eventHandlers.mouseUp);\n            }\n            if (this._eventHandlers.contextMenu) {\n                this._currentCanvas.removeEventListener('contextmenu', this._eventHandlers.contextMenu);\n            }\n            if (this._eventHandlers.mouseLeave) {\n                this._currentCanvas.removeEventListener('mouseleave', this._eventHandlers.mouseLeave);\n            }\n            if (this._eventHandlers.documentMouseUp) {\n                document.removeEventListener('mouseup', this._eventHandlers.documentMouseUp, true); // Use capture phase\n            }\n        }\n        \n        // Store the current canvas for future cleanup\n        this._currentCanvas = canvas;\n        \n        // Create bound event handlers\n        this._eventHandlers.mouseMove = this.handleMouseMove.bind(this);\n        this._eventHandlers.mouseDown = this.handleMouseDown.bind(this);\n        this._eventHandlers.mouseUp = this.handleMouseUp.bind(this);\n        this._eventHandlers.contextMenu = this.handleContextMenu.bind(this);\n        this._eventHandlers.mouseLeave = this.handleMouseLeave.bind(this);\n        this._eventHandlers.documentMouseUp = this.handleDocumentMouseUp.bind(this);\n        \n        // Add event listeners\n        canvas.addEventListener('mousemove', this._eventHandlers.mouseMove);\n        canvas.addEventListener('mousedown', this._eventHandlers.mouseDown);\n        canvas.addEventListener('mouseup', this._eventHandlers.mouseUp);\n        canvas.addEventListener('contextmenu', this._eventHandlers.contextMenu);\n        canvas.addEventListener('mouseleave', this._eventHandlers.mouseLeave);\n        document.addEventListener('mouseup', this._eventHandlers.documentMouseUp);\n        \n        // Reset selection state\n        this.selectedCell = null;\n        this.hoveredCell = null;\n        this.isDragging = false;\n        this.lastProcessedCell = null;\n        this.dragButton = null;\n        \n        // Make sure tooltip is in the DOM\n        if (!document.body.contains(this.tooltip)) {\n            document.body.appendChild(this.tooltip);\n        }\n    }\n    \n    /**\n     * Create the tooltip element\n     * @private\n     */\n    createTooltip() {\n        const tooltip = document.createElement('div');\n        tooltip.className = 'temperature-tooltip';\n        tooltip.style.position = 'absolute';\n        tooltip.style.pointerEvents = 'none';\n        tooltip.style.padding = '4px 8px';\n        tooltip.style.background = 'rgba(0, 0, 0, 0.7)';\n        tooltip.style.color = 'white';\n        tooltip.style.borderRadius = '4px';\n        tooltip.style.fontSize = '12px';\n        tooltip.style.fontFamily = 'Arial, sans-serif';\n        tooltip.style.visibility = 'hidden';\n        tooltip.style.zIndex = '1000';\n        tooltip.style.transition = 'opacity 0.2s';\n        return tooltip;\n    }\n    \n     /**\n     * Handle mouse movement to update tooltip and handle drag operations\n     * @param {MouseEvent} event - Mouse move event\n     */\n    handleMouseMove(event) {\n        if (!this.canvas) return;\n        \n        const isRightButtonDown = (event.buttons & 2) === 2; // Check if right button is currently down\n        \n        // If we have a pending right-click and the mouse moves, clear it\n        if (this._pendingRightClick) {\n            // If right button is no longer down, clean up\n            if (!isRightButtonDown) {\n                clearTimeout(this._pendingRightClick);\n                this._pendingRightClick = null;\n                \n                // If we were dragging, clean up the drag state\n                if (this.isDragging && this.dragButton === 2) {\n                    this.cleanupDragState();\n                }\n            } else {\n                // Right button is still down, just clear the timeout but keep the pending state\n                clearTimeout(this._pendingRightClick);\n                this._pendingRightClick = null;\n            }\n        }\n        \n        const rect = this.canvas.getBoundingClientRect();\n        const x = event.clientX - rect.left;\n        const y = event.clientY - rect.top;\n        \n        // Update hovered cell\n        const cellX = Math.floor(x / this.cellSize);\n        const cellY = Math.floor(y / this.cellSize);\n        \n        // Only update if the cell changed\n        if (!this.hoveredCell || this.hoveredCell.x !== cellX || this.hoveredCell.y !== cellY) {\n            this.hoveredCell = { x: cellX, y: cellY };\n            \n            // Update tooltip position if active\n            if (this.tooltip && this.tooltip.isVisible) {\n                this.updateTooltipPosition(event);\n            }\n            \n            // Handle temperature adjustment if in admin mode and dragging\n            if (this.isDragging && this.onTemperatureAdjust && this.isAdmin) {\n                const cells = this.getBrushCells(this.hoveredCell.x, this.hoveredCell.y);\n                cells.forEach(cell => {\n                    this.onTemperatureAdjust(cell.x, cell.y, this.tempAdjustDirection === -1);\n                });\n            }\n        }\n    }\n    \n    /**\n     * Handle mouse click to select a cell\n     * @param {MouseEvent} event - Mouse click event\n     */\n    handleClick(event) {\n        if (!this.hoveredCell) return;\n        \n        // Handle cell selection logic here\n        if (this.onCellSelected) {\n            this.onCellSelected(this.hoveredCell.x, this.hoveredCell.y);\n        }\n    }\n    \n    /**\n     * Get all cells in the brush area\n     * @param {number} centerX - X coordinate of the center cell\n     * @param {number} centerY - Y coordinate of the center cell\n     * @returns {Array<{x: number, y: number}>} Array of cell coordinates in the brush\n{{ ... }}\n     */\n    getBrushCells(centerX, centerY) {\n        if (this.brushSize === 0 || !this.isAdmin) {\n            return [{ x: centerX, y: centerY }];\n        }\n        \n        const cells = [];\n        const radius = this.brushSize;\n        const radiusSq = radius * radius;\n        \n        // Include all cells within the circular radius\n        for (let y = -radius; y <= radius; y++) {\n            for (let x = -radius; x <= radius; x++) {\n                // Check if cell is within circular radius\n                if (x*x + y*y <= radiusSq) {\n                    cells.push({\n                        x: centerX + x,\n                        y: centerY + y\n                    });\n                }\n            }\n        }\n        \n        return cells;\n    }\n    \n    /**\n     * Toggle brush size between 0 (single cell) and 2 (5x5 circle)\n     */\n    toggleBrushSize() {\n        this.brushSize = this.brushSize === 0 ? 2 : 0;\n    }\n    /**\n     * Handle document-level mouse up events\n     * @param {MouseEvent} event - The mouse up event\n     * @returns {boolean} True if the event was handled, false otherwise\n     */\n    handleDocumentMouseUp(event) {\n        // If we're dragging and this is the button that started the drag\n        const isRightClick = event.button === 2;\n        const isDraggingWithRightButton = this.isDragging && this.dragButton === 2;\n        \n        if (isDraggingWithRightButton || (this.isDragging && (this.dragButton === null || event.button === this.dragButton))) {\n            \n            // Completely clean up the drag state\n            this.cleanupDragState();\n            \n            // Always prevent default for right-clicks during drag\n            if (isRightClick || isDraggingWithRightButton) {\n                event.stopImmediatePropagation();\n                event.preventDefault();\n                return true;\n            }\n            \n            event.stopPropagation();\n            event.preventDefault();\n            return true; // Indicate we handled this event\n        }\n        \n        // Also handle right-click release even if we weren't dragging\n        if (isRightClick && this._pendingRightClick) {\n            clearTimeout(this._pendingRightClick);\n            this._pendingRightClick = null;\n        }\n        \n        return false;\n    }\n    \n    /**\n     * Handle context menu events\n     * @param {MouseEvent} event - The context menu event\n     * @returns {boolean} True if the event was handled, false otherwise\n     */\n    handleContextMenu(event) {\n        // Always prevent default context menu\n        event.preventDefault();\n        \n        // If we were dragging with right button, reset the state\n        if (this.isDragging && this.dragButton === 2) {\n            this.resetDragState();\n            return true;\n        }\n        \n        // If in admin mode, handle as a right-click\n        if (this.isAdmin) {\n            this.handleMouseDown(event);\n            return true;\n        }\n        \n        return false;\n    }\n    \n    /**\n     * Handle mouse leave events\n     */\n    handleMouseLeave() {\n        this.tooltip.style.visibility = 'hidden';\n        // If we're dragging and leave the canvas, stop the drag\n        if (this.isDragging) {\n            this.resetDragState();\n        }\n    }\n    \n    /**\n     * Reset the drag state\n     */\n    /**\n     * Completely clean up all drag state\n     */\n    cleanupDragState() {\n        this.isDragging = false;\n        this.dragButton = null;\n        this.lastProcessedCell = null;\n        this.tempAdjustDirection = 0;\n        \n        // Clear any pending timeouts\n        if (this._pendingRightClick) {\n            clearTimeout(this._pendingRightClick);\n            this._pendingRightClick = null;\n        }\n    }\n    \n    /**\n     * Reset the drag state\n     */\n    resetDragState() {\n        if (this.isDragging) {\n            this.cleanupDragState();\n        }\n    }\n    \n    /**\n     * Handle mouse up events\n     * @param {MouseEvent} event - The mouse up event\n     */\n    handleMouseUp(event) {\n        const isRightClick = event.button === 2;\n        const isDraggingWithRightButton = this.isDragging && this.dragButton === 2;\n        \n        // Only process if we were dragging and the button matches, or if it's a right-click release\n        if ((!this.isDragging || (this.dragButton !== null && event.button !== this.dragButton)) && !isRightClick) {\n            return;\n        }\n        \n        // For right-clicks, be extra aggressive with prevention\n        if (isRightClick || isDraggingWithRightButton) {\n            event.stopImmediatePropagation();\n            event.preventDefault();\n            this.cleanupDragState();\n            return;\n        }\n        \n        // For other mouse buttons\n        this.cleanupDragState();\n        event.stopPropagation();\n        event.preventDefault();\n        \n        // Clear any pending right-click state\n        if (this._pendingRightClick) {\n            clearTimeout(this._pendingRightClick);\n            this._pendingRightClick = null;\n        }\n    }\n    \n    /**\n     * Handle mouse down events\n     * @param {MouseEvent} event - The mouse down event\n     */\n    handleMouseDown(event) {\n        if (!this.hoveredCell) return;\n        \n        const isRightClick = event.button === 2;\n        \n        // Always prevent default for right-clicks to avoid context menu\n        if (isRightClick) {\n            event.stopImmediatePropagation();\n            event.preventDefault();\n        } else {\n            event.stopPropagation();\n            event.preventDefault();\n        }\n        \n        // Reset any existing drag state to be safe\n        this.cleanupDragState();\n        \n        // Handle right-click for temperature decrease\n        if (isRightClick) {\n            // Clear any existing pending right-click timeout\n            if (this._pendingRightClick) {\n                clearTimeout(this._pendingRightClick);\n                this._pendingRightClick = null;\n            }\n            \n            // Set up drag state\n            this.isDragging = true;\n            this.tempAdjustDirection = -1;\n            this.lastProcessedCell = this.hoveredCell ? { ...this.hoveredCell } : null;\n            \n            // Set a safety timeout to ensure we clean up if the mouseup event is missed\n            this._pendingRightClick = setTimeout(() => {\n                if (this.isDragging) {\n                    this.cleanupDragState();\n                    try {\n                        const mouseUpEvent = new MouseEvent('mouseup', {\n                            bubbles: true,\n                            cancelable: true,\n                            button: 2,\n                            buttons: 0\n                        });\n                        document.dispatchEvent(mouseUpEvent);\n                    } catch (e) {\n                        // Silently handle any errors\n                    }\n                }\n                this._pendingRightClick = null;\n            }, 3000); // Reduced to 3 seconds for faster recovery\n            \n            return;\n        }\n        // Handle shift+left-click for temperature increase\n        if (event.shiftKey && event.button === 0) {\n            this.isDragging = true;\n            this.tempAdjustDirection = 1;\n            this.lastProcessedCell = { ...this.hoveredCell };\n            this.dragButton = 0; // Left mouse button\n            \n            // Process the initial click\n            if (this.onTemperatureAdjust) {\n                const cells = this.getBrushCells(this.hoveredCell.x, this.hoveredCell.y);\n                cells.forEach(cell => {\n                    this.onTemperatureAdjust(cell.x, cell.y, false);\n                });\n            }\n            return;\n        }\n        // Handle regular left-click for selection\n        if (event.button === 0) {\n            this.handleSelection();\n        }\n    }\n    \n    handleSelection() {\n        if (!this.hoveredCell) return;\n        \n        const isSameCell = this.selectedCell && \n                         this.selectedCell.x === this.hoveredCell.x && \n                         this.selectedCell.y === this.hoveredCell.y;\n        \n        if (isSameCell) {\n            // Deselect if clicking the same cell\n            this.selectedCell = null;\n        } else {\n            // Select the new cell\n            this.selectedCell = { ...this.hoveredCell };\n        }\n    }\n    \n    /**\n     * Update the tooltip with temperature information\n     * @param {number} temperature - The temperature to display\n     */\n    updateTooltip(temperature) {\n        if (!this.hoveredCell) {\n            this.tooltip.style.visibility = 'hidden';\n            return;\n        }\n        \n        this.tooltip.textContent = `${temperature.toFixed(1)}Â°C`;\n        this.tooltip.style.visibility = 'visible';\n    }\n    \n    /**\n     * Get the currently selected cell\n     * @returns {{x: number, y: number} | null} The selected cell coordinates or null if none selected\n     */\n    getSelectedCell() {\n        return this.selectedCell;\n    }\n    \n    /**\n     * Get the currently hovered cell\n     * @returns {{x: number, y: number} | null} The hovered cell coordinates or null if none\n     */\n    getHoveredCell() {\n        return this.hoveredCell;\n    }\n    \n    /**\n     * Render the selection overlay\n     * @param {CanvasRenderingContext2D} ctx - The canvas context\n     */\n    render(ctx) {\n        ctx.save();\n        \n        // Draw hover effect if there's a hovered cell\n        if (this.hoveredCell) {\n            const cells = this.isAdmin && this.brushSize > 0 ? \n                this.getBrushCells(this.hoveredCell.x, this.hoveredCell.y) : \n                [this.hoveredCell];\n            \n            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';\n            ctx.lineWidth = 1;\n            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';\n            \n            cells.forEach(cell => {\n                const { x, y } = cell;\n                ctx.strokeRect(\n                    x * this.cellSize + 1,\n                    y * this.cellSize + 1,\n                    this.cellSize - 2,\n                    this.cellSize - 2\n                );\n                ctx.fillRect(\n                    x * this.cellSize + 1,\n                    y * this.cellSize + 1,\n                    this.cellSize - 2,\n                    this.cellSize - 2\n                );\n            });\n        }\n        \n        // Always draw selection if there's a selected cell\n        if (this.selectedCell) {\n            const { x, y } = this.selectedCell;\n            ctx.strokeStyle = 'rgba(0, 255, 255, 0.8)';\n            ctx.lineWidth = 3;\n            ctx.strokeRect(\n                x * this.cellSize + 1,\n                y * this.cellSize + 1,\n                this.cellSize - 2,\n                this.cellSize - 2\n            );\n        }\n        \n        ctx.restore();\n    }\n}\n\n// Export a singleton instance\nexport const selectionManager = new SelectionManager();\n","import { logger } from './logger.js';\n\n// JavaScript implementation of the temperature system\nclass JsTemperatureSystem {\n    constructor(width, height, ambientTemp = 20) {\n        this.width = width;\n        this.height = height;\n        this.ambientTemp = ambientTemp;\n        this.cells = [];\n        this.initialize();\n    }\n\n    initialize() {\n        const centerX = this.width / 2;\n        const centerY = this.height / 2;\n        const maxDist = Math.sqrt(centerX * centerX + centerY * centerY);\n        \n        for (let y = 0; y < this.height; y++) {\n            const row = [];\n            for (let x = 0; x < this.width; x++) {\n                const dx = x - centerX;\n                const dy = y - centerY;\n                const dist = Math.sqrt(dx * dx + dy * dy) / maxDist;\n                const temp = this.ambientTemp * (1 - dist * 0.5);\n                row.push({\n                    temperature: temp,\n                    nextTemperature: temp,\n                    lastUpdate: 0\n                });\n            }\n            this.cells.push(row);\n        }\n    }\n\n    update(deltaTime) {\n        // Simple temperature diffusion\n        for (let y = 0; y < this.height; y++) {\n            for (let x = 0; x < this.width; x++) {\n                this.diffuseTemperature(x, y);\n            }\n        }\n        \n        // Update temperatures\n        for (let y = 0; y < this.height; y++) {\n            for (let x = 0; x < this.width; x++) {\n                const cell = this.cells[y][x];\n                cell.temperature = cell.nextTemperature;\n                cell.lastUpdate = performance.now();\n            }\n        }\n        return true;\n    }\n    \n    diffuseTemperature(x, y) {\n        const cell = this.cells[y][x];\n        const neighbors = [];\n        const dirs = [[0, 1], [1, 0], [0, -1], [-1, 0]]; // 4-way connectivity\n        \n        // Get valid neighbors\n        for (const [dx, dy] of dirs) {\n            const nx = x + dx;\n            const ny = y + dy;\n            if (nx >= 0 && nx < this.width && ny >= 0 && ny < this.height) {\n                neighbors.push(this.cells[ny][nx]);\n            }\n        }\n        \n        if (neighbors.length > 0) {\n            // Simple diffusion: average with neighbors\n            const sum = neighbors.reduce((acc, n) => acc + n.temperature, 0);\n            const avg = sum / neighbors.length;\n            const diff = (avg - cell.temperature) * 0.1; // Diffusion rate\n            cell.nextTemperature = cell.temperature + diff;\n        } else {\n            cell.nextTemperature = cell.temperature;\n        }\n    }\n    \n    getTemperature(x, y) {\n        if (x < 0 || x >= this.width || y < 0 || y >= this.height) {\n            return this.ambientTemp;\n        }\n        return this.cells[y][x].temperature;\n    }\n    \n    setTemperature(x, y, temp) {\n        if (x >= 0 && x < this.width && y >= 0 && y < this.height) {\n            this.cells[y][x].temperature = temp;\n            this.cells[y][x].nextTemperature = temp;\n        }\n    }\n    \n    getTemperatureData() {\n        const result = [this.width, this.height];\n        for (let y = 0; y < this.height; y++) {\n            for (let x = 0; x < this.width; x++) {\n                result.push(this.cells[y][x].temperature);\n            }\n        }\n        return result;\n    }\n}\n\nexport class TemperatureManager {\n    constructor() {\n        this.temperatureSystem = null;\n        this.showTemperature = false;\n        this.lastUpdate = 0;\n        this.updateInterval = 100; // ms between updates\n        \n        // Temperature ranges and colors similar to Oxygen Not Included\n        this.temperatureRanges = [\n            { min: -273.15, max: -100, color: { r: 0, g: 0, b: 139 } },     // Dark Blue\n            { min: -100, max: -50, color: { r: 0, g: 0, b: 255 } },         // Blue\n            { min: -50, max: -20, color: { r: 0, g: 191, b: 255 } },        // Light Blue\n            { min: -20, max: 0, color: { r: 173, g: 216, b: 230 } },        // Light Cyan\n            { min: 0, max: 20, color: { r: 144, g: 238, b: 144 } },         // Light Green\n            { min: 20, max: 40, color: { r: 255, g: 255, b: 0 } },          // Yellow\n            { min: 40, max: 60, color: { r: 255, g: 165, b: 0 } },          // Orange\n            { min: 60, max: 80, color: { r: 255, g: 69, b: 0 } },           // Red-Orange\n            { min: 80, max: 100, color: { r: 255, g: 0, b: 0 } },           // Red\n            { min: 100, max: 120, color: { r: 178, g: 34, b: 34 } },        // Firebrick\n            { min: 120, max: 1000, color: { r: 128, g: 0, b: 0 } }          // Dark Red\n        ];\n        \n        this.minTemp = this.temperatureRanges[0].min;\n        this.maxTemp = this.temperatureRanges[this.temperatureRanges.length - 1].max;\n    }\n\n    /**\n     * Initialize the temperature system with the given grid dimensions\n     * @param {number} width - Grid width in cells\n     * @param {number} height - Grid height in cells\n     * @param {number} [ambientTemp=20] - Ambient temperature in Celsius\n     */\n    async initialize(width, height, ambientTemp = 20) {\n        try {\n            // Use the JavaScript implementation\n            this.temperatureSystem = new JsTemperatureSystem(width, height, ambientTemp);\n            this.useWasm = false;\n            this.lastUpdate = performance.now();\n            logger.log('Temperature system (JS) initialized');\n        } catch (error) {\n            logger.error('Failed to initialize temperature system:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Update the temperature system\n     */\n    update() {\n        if (!this.temperatureSystem) return;\n        \n        const now = performance.now();\n        const deltaTime = now - this.lastUpdate;\n        \n        if (deltaTime >= this.updateInterval) {\n            this.temperatureSystem.update(deltaTime);\n            this.lastUpdate = now;\n            return true; // Indicate that an update occurred\n        }\n        \n        return false;\n    }\n\n    /**\n     * Toggle temperature visualization\n     */\n    toggleTemperatureView() {\n        this.showTemperature = !this.showTemperature;\n        logger.log(`Temperature view: ${this.showTemperature ? 'ON' : 'OFF'}`);\n        return this.showTemperature;\n    }\n\n    /**\n     * Get the color for a temperature value\n     * @param {number} temp - Temperature in Celsius\n     * @returns {string} CSS color string\n     */\n    getTemperatureColor(temp) {\n        // Find the appropriate temperature range\n        const range = this.temperatureRanges.find(range => temp >= range.min && temp < range.max) || \n                     this.temperatureRanges[this.temperatureRanges.length - 1];\n        \n        // If we're at the end of the range, just return the color directly\n        if (temp >= this.temperatureRanges[this.temperatureRanges.length - 1].max) {\n            const c = this.temperatureRanges[this.temperatureRanges.length - 1].color;\n            return `rgb(${c.r}, ${c.g}, ${c.b})`;\n        }\n        \n        // Find the next range for interpolation\n        const nextRange = this.temperatureRanges[this.temperatureRanges.indexOf(range) + 1];\n        \n        if (!nextRange) {\n            const c = range.color;\n            return `rgb(${c.r}, ${c.g}, ${c.b})`;\n        }\n        \n        // Calculate interpolation factor (0-1) between the two ranges\n        const rangeMin = range.min;\n        const rangeMax = nextRange.max;\n        const factor = (temp - rangeMin) / (rangeMax - rangeMin);\n        \n        // Interpolate between the two colors\n        const r = Math.round(range.color.r + (nextRange.color.r - range.color.r) * factor);\n        const g = Math.round(range.color.g + (nextRange.color.g - range.color.g) * factor);\n        const b = Math.round(range.color.b + (nextRange.color.b - range.color.b) * factor);\n        \n        return `rgb(${r}, ${g}, ${b})`;\n    }\n\n    /**\n     * Render the temperature overlay\n     * @param {CanvasRenderingContext2D} ctx - Canvas 2D context\n     * @param {number} cellSize - Size of each cell in pixels\n     */\n    render(ctx, cellSize, showTemperature = false) {\n        if (!showTemperature || !this.temperatureSystem) return;\n        \n        try {\n            // Get temperature data as a flat array [width, height, t0, t1, t2, ...]\n            const tempData = this.temperatureSystem.getTemperatureData();\n            const width = tempData[0];\n            const height = tempData[1];\n            \n            // Draw temperature overlay\n            ctx.save();\n            ctx.globalAlpha = 0.7;\n            \n            for (let y = 0; y < height; y++) {\n                for (let x = 0; x < width; x++) {\n                    const temp = tempData[2 + y * width + x];\n                    ctx.fillStyle = this.getTemperatureColor(temp);\n                    ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);\n                }\n            }\n            \n            ctx.restore();\n        } catch (error) {\n            logger.error('Error rendering temperature overlay:', error);\n        }\n    }\n\n    /**\n     * Get the temperature at a specific grid position\n     * @param {number} x - X coordinate\n     * @param {number} y - Y coordinate\n     * @returns {number} Temperature in Celsius\n     */\n    getTemperature(x, y) {\n        if (!this.temperatureSystem) return this.minTemp;\n        return this.temperatureSystem.getTemperature(x, y);\n    }\n\n    /**\n     * Set the temperature at a specific grid position\n     * @param {number} x - X coordinate\n     * @param {number} y - Y coordinate\n     * @param {number} temp - Temperature in Celsius\n     */\n    setTemperature(x, y, temp) {\n        if (this.temperatureSystem) {\n            this.temperatureSystem.setTemperature(x, y, temp);\n        }\n    }\n}\n\n// Export a singleton instance\nexport const temperatureManager = new TemperatureManager();\n","import { logger } from './logger.js';\nimport { saveManager } from './saveManager.js';\nimport { UIManager } from './uiManager.js';\nimport { selectionManager } from './selectionManager.js';\nimport { temperatureManager } from './temperatureManager.js';\n\nclass App {\n    constructor() {\n        this.isInitialized = false;\n        this.isInitializing = false;\n        this.wasmInitializationPromise = null;\n        this.currentMainLoop = null;\n        this.isRunning = false;\n        this.isPaused = false;\n        this.isAdmin = false; // Admin mode flag\n        this.gameState = null;\n        this.showTemperature = false; // Toggle for temperature visualization\n        this.adminIndicator = null; // Will hold the admin indicator element\n        \n        // Initialize managers\n        this.selectionManager = selectionManager;\n        this.temperatureManager = temperatureManager;\n        \n        // Setup temperature adjustment handler\n        this.selectionManager.onTemperatureAdjust = (x, y, isDecrease = false) => {\n            if (this.isAdmin) {\n                const currentTemp = this.temperatureManager.getTemperature(x, y);\n                const change = isDecrease ? -10 : 10;\n                const newTemp = currentTemp + change;\n                this.temperatureManager.setTemperature(x, y, newTemp);\n            }\n            // No logging of temperature changes\n        };\n        \n        // Initialize Save Manager\n        this.saveManager = saveManager;\n        \n        // Initialize UI Manager with reference to this app instance\n        this.uiManager = new UIManager(this);\n        \n        // Initialize diagnostics channel\n        this.diagChannel = null;\n        this.setupDiagnostics();\n        \n        // Bind keyboard events\n        this.handleKeyDown = this.handleKeyDown.bind(this);\n        document.addEventListener('keydown', this.handleKeyDown);\n        \n        // Initialize render method\n        this.render = this.render.bind(this);\n    }\n\n    async initialize() {\n        if (this.isInitialized) {\n            logger.log('Application already initialized');\n            return;\n        }\n        \n        if (this.isInitializing) {\n            logger.log('Application initialization already in progress');\n            return this.initializationPromise || Promise.resolve();\n        }\n        \n        this.isInitializing = true;\n        \n        try {\n            logger.log('Initializing application...');\n            \n            // Initialize UI\n            this.uiManager.initialize();\n            this.setupDiagnostics();\n            \n            // Wait for WebAssembly to be ready\n            await this.waitForWasmReady();\n            \n            // Initialize WebAssembly module\n            if (window.Module && typeof window.Module._initialize === 'function') {\n                logger.log('Initializing WebAssembly module...');\n                this.wasmInitializationPromise = this.initializeWasm();\n                await this.wasmInitializationPromise;\n            } else {\n                logger.warn('WebAssembly module not found or missing initialization function');\n            }\n            \n            this.isInitialized = true;\n            logger.log('Application initialized successfully');\n        } catch (error) {\n            logger.error('Error during initialization:', error);\n            throw error;\n        } finally {\n            this.isInitializing = false;\n        }\n    }\n\n    // UI-related methods have been moved to UIManager\n\n    // UI-related methods have been moved to UIManager\n\n    /**\n     * Main render loop\n     * @param {number} timestamp - Current timestamp from requestAnimationFrame\n     */\n    async render(timestamp) {\n        try {\n            if (!this.lastRenderTime) {\n                this.lastRenderTime = timestamp;\n            }\n            \n            const deltaTime = timestamp - this.lastRenderTime;\n            this.lastRenderTime = timestamp;\n            \n            // Get canvas context\n            const canvas = document.querySelector('canvas');\n            if (!canvas) return;\n            \n            const ctx = canvas.getContext('2d');\n            if (!ctx) return;\n            \n            // Clear the canvas\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\n            \n            // Always update temperature system, but only render if enabled\n            if (this.temperatureManager) {\n                this.temperatureManager.update();\n                \n                // Update selection tooltip if hovering over a cell\n                if (this.selectionManager) {\n                    const hoveredCell = this.selectionManager.getHoveredCell();\n                    if (hoveredCell) {\n                        const temp = this.temperatureManager.getTemperature(hoveredCell.x, hoveredCell.y);\n                        this.selectionManager.updateTooltip(temp);\n                    }\n                }\n                \n                // Draw temperature overlay (pass the showTemperature flag)\n                this.temperatureManager.render(ctx, this.grid?.cellSize || 20, this.showTemperature);\n            }\n            \n            // Draw the grid\n            await this.drawGrid(ctx, canvas.width, canvas.height);\n            \n            // Draw selection and hover effects\n            if (this.selectionManager) {\n                this.selectionManager.render(ctx);\n                \n                // Update debug overlay with selected cell info\n                let cellInfo = null;\n                const selectedCell = this.selectionManager.getSelectedCell();\n                if (selectedCell && this.temperatureManager) {\n                    const temp = this.temperatureManager.getTemperature(selectedCell.x, selectedCell.y);\n                    cellInfo = { \n                        temp,\n                        x: selectedCell.x,\n                        y: selectedCell.y\n                    };\n                }\n                \n                if (this.uiManager && this.uiManager.updateDebugOverlay) {\n                    this.uiManager.updateDebugOverlay(timestamp, cellInfo);\n                }\n            }\n            \n            // Continue the animation loop if running\n            if (this.isRunning) {\n                this.currentMainLoop = requestAnimationFrame(this.render.bind(this));\n            }\n        } catch (error) {\n            logger.error('Error in render loop:', error);\n            // Stop the animation loop on error\n            this.isRunning = false;\n            throw error;\n        }\n    }\n\n    setupDiagnostics() {\n        try {\n            this.diagChannel = new BroadcastChannel('evolution-sim-diag');\n            \n            // Handle incoming messages\n            this.diagChannel.onmessage = (event) => {\n                const { type, data } = event.data;\n                \n                switch (type) {\n                    case 'command':\n                        this.handleAdminCommand(data);\n                        break;\n                    case 'status':\n                        // Handle status updates if needed\n                        break;\n                }\n            };\n            \n            // Send initial status\n            this.sendDiagMessage('status', { \n                connected: true,\n                isAdmin: this.isAdmin,\n                commands: [\n                    'set admin true|false',\n                    'getStatus'\n                ]\n            });\n            \n            // Set up a ping interval to keep the connection alive\n            this.diagPingInterval = setInterval(() => {\n                this.sendDiagMessage('status', { \n                    connected: true,\n                    isAdmin: this.isAdmin\n                });\n            }, 10000); // Send status every 10 seconds\n            \n            // Send a welcome message\n            this.sendDiagMessage('log', {\n                message: 'Diagnostics channel initialized',\n                type: 'info',\n                isAdmin: this.isAdmin\n            });\n            \n        } catch (error) {\n            console.error('Failed to initialize diagnostics channel:', error);\n        }\n    }\n\n    sendDiagMessage(type, data = {}) {\n        if (!this.diagChannel) return;\n        \n        try {\n            this.diagChannel.postMessage({\n                type,\n                timestamp: new Date().toISOString(),\n                data: {\n                    ...data,\n                    isAdmin: this.isAdmin // Always include admin status in messages\n                }\n            });\n        } catch (error) {\n            logger.error('Error sending diagnostic message:', error);\n        }\n    }\n    \n    /**\n     * Handles admin commands from the diagnostic console\n     * @param {Object} command - The command to handle\n     * @param {string} command.type - The type of command\n     * @param {any} command.data - Command data\n     */\n    handleAdminCommand(command) {\n        if (!command || !command.type) return;\n        \n        // Only log the command type, not the full data\n        logger.log(`Admin command: ${command.type} ${command.data?.key || ''}`);\n        \n        // Handle 'set' commands (e.g., 'set admin true')\n        if (command.type === 'set' && command.data && command.data.key) {\n            const { key, value } = command.data;\n            \n            switch (key.toLowerCase()) {\n                case 'admin':\n                    const adminState = String(value).toLowerCase() === 'true';\n                    if (this.isAdmin !== adminState) {\n                        this.toggleAdminMode();\n                        // Only log the state change, not the command\n                        logger.log(`Admin mode ${adminState ? 'enabled' : 'disabled'}`);\n                    }\n                    break;\n                default:\n                    logger.warn(`Unknown setting: ${key}`);\n            }\n            return;\n        }\n        \n        // Handle other command types\n        switch (command.type) {\n            case 'getStatus':\n                this.sendDiagMessage('status', {\n                    isAdmin: this.isAdmin,\n                    isRunning: this.isRunning,\n                    isPaused: this.isPaused,\n                    showTemperature: this.showTemperature\n                });\n                break;\n            default:\n                logger.warn(`Unknown admin command: ${command.type}`);\n        }\n    }\n    \n    /**\n     * Toggles admin mode on/off\n     */\n    toggleAdminMode() {\n        this.isAdmin = !this.isAdmin;\n        \n        // Update UI to show admin status\n        this.updateAdminUI();\n        \n        // Log the change\n        logger.log(`Admin mode ${this.isAdmin ? 'enabled' : 'disabled'}`);\n        \n        // Send updated status\n        this.sendDiagMessage('adminStatus', { isAdmin: this.isAdmin });\n    }\n    \n    /**\n     * Updates the UI to reflect the current admin status\n     */\n    updateAdminUI() {\n        // Create or update the admin container\n        if (!this.adminContainer) {\n            // Create a container for admin UI elements\n            this.adminContainer = document.createElement('div');\n            this.adminContainer.id = 'admin-container';\n            this.adminContainer.style.position = 'fixed';\n            this.adminContainer.style.top = '10px';\n            this.adminContainer.style.right = '10px';\n            this.adminContainer.style.display = 'flex';\n            this.adminContainer.style.flexDirection = 'column';\n            this.adminContainer.style.gap = '5px';\n            this.adminContainer.style.zIndex = '1000';\n            document.body.appendChild(this.adminContainer);\n            \n            // Create the admin indicator\n            this.adminIndicator = document.createElement('div');\n            this.adminIndicator.id = 'admin-indicator';\n            this.adminIndicator.style.padding = '5px 10px';\n            this.adminIndicator.style.borderRadius = '4px';\n            this.adminIndicator.style.fontFamily = 'monospace';\n            this.adminIndicator.style.fontWeight = 'bold';\n            this.adminIndicator.textContent = 'ADMIN MODE';\n            this.adminContainer.appendChild(this.adminIndicator);\n            \n            // Create the brush button\n            this.adminBrushButton = document.createElement('button');\n            this.adminBrushButton.id = 'admin-brush-button';\n            this.updateBrushButtonText();\n            this.adminBrushButton.style.padding = '5px 10px';\n            this.adminBrushButton.style.borderRadius = '4px';\n            this.adminBrushButton.style.border = '1px solid #ccc';\n            this.adminBrushButton.style.cursor = 'pointer';\n            this.adminBrushButton.addEventListener('click', (e) => {\n                e.stopPropagation();\n                if (this.selectionManager) {\n                    this.selectionManager.toggleBrushSize();\n                    this.updateBrushButtonText();\n                    logger.log(`Brush size toggled to ${this.selectionManager.brushSize === 0 ? '1x1' : '5x5 circle'}`);\n                }\n            });\n            this.adminContainer.appendChild(this.adminBrushButton);\n        }\n        \n        // Update visibility based on admin mode\n        if (this.isAdmin) {\n            this.adminContainer.style.display = 'flex';\n            this.adminIndicator.style.display = 'block';\n            this.adminBrushButton.style.display = 'block';\n            \n            // Set admin mode on selection manager\n            if (this.selectionManager) {\n                this.selectionManager.isAdmin = true;\n            }\n            \n            // Add admin keydown listener\n            document.addEventListener('keydown', this.handleAdminKeyDown.bind(this));\n        } else {\n            this.adminContainer.style.display = 'none';\n            this.adminIndicator.style.display = 'none';\n            this.adminBrushButton.style.display = 'none';\n            \n            // Remove admin keydown listener\n            document.removeEventListener('keydown', this.handleAdminKeyDown.bind(this));\n            \n            // Reset selection manager admin state\n            if (this.selectionManager) {\n                this.selectionManager.isAdmin = false;\n                this.selectionManager.brushSize = 0; // Reset brush size when exiting admin mode\n            }\n        }\n    }\n    \n    /**\n     * Handles keyboard shortcuts when in admin mode\n     * @param {KeyboardEvent} event - The keyboard event\n     */\n    handleAdminKeyDown(event) {\n        if (!this.isAdmin) return;\n        \n        // Example: Toggle temperature overlay with T\n        if (event.key.toLowerCase() === 't') {\n            this.showTemperature = !this.showTemperature;\n            logger.log(`Temperature overlay ${this.showTemperature ? 'enabled' : 'disabled'}`);\n        }\n        \n        // Add more admin shortcuts as needed\n    }\n\n    waitForWasmReady() {\n        return new Promise((resolve, reject) => {\n            if (window.wasmReady) {\n                logger.log('WebAssembly already initialized');\n                resolve();\n                return;\n            }\n            \n            logger.log('Waiting for WebAssembly to be ready...');\n            const timeout = setTimeout(() => {\n                const error = new Error('WebAssembly initialization timed out after 30 seconds');\n                logger.error(error.message);\n                \n                // Log additional debug information\n                if (window.Module) {\n                    logger.error('WebAssembly Module state:', {\n                        status: window.Module.status,\n                        error: window.Module.error,\n                        ready: window.Module.asm ? 'Module.asm exists' : 'Module.asm is undefined'\n                    });\n                } else {\n                    logger.error('window.Module is not defined');\n                }\n                \n                reject(error);\n            }, 30000); // 30 second timeout\n            \n            // Listen for the wasm-ready event\n            const onWasmReady = () => {\n                clearTimeout(timeout);\n                document.removeEventListener('wasm-ready', onWasmReady);\n                logger.log('WebAssembly ready event received');\n                resolve(true);\n            };\n            \n            document.addEventListener('wasm-ready', onWasmReady);\n            \n            // Also check periodically in case the event was missed\n            const checkReady = () => {\n                if (window.wasmReady) {\n                    clearTimeout(timeout);\n                    document.removeEventListener('wasm-ready', onWasmReady);\n                    logger.log('WebAssembly ready (window.wasmReady = true)');\n                    resolve(true);\n                } else if (window.Module && window.Module.asm) {\n                    clearTimeout(timeout);\n                    document.removeEventListener('wasm-ready', onWasmReady);\n                    logger.log('WebAssembly ready (Module.asm detected)');\n                    resolve(true);\n                } else {\n                    requestAnimationFrame(checkReady);\n                }\n            };\n            \n            // Start checking\n            checkReady();\n        });\n    }\n    \n    /**\n     * Updates the brush button text based on the current brush size\n     */\n    updateBrushButtonText() {\n        if (this.adminBrushButton && this.selectionManager) {\n            this.adminBrushButton.textContent = `Brush: ${this.selectionManager.brushSize === 0 ? '1x1' : '5x5'}`;\n            this.adminBrushButton.style.backgroundColor = this.selectionManager.brushSize === 0 ? '#f0f0f0' : '#4CAF50';\n            this.adminBrushButton.style.color = this.selectionManager.brushSize === 0 ? '#000' : '#fff';\n        }\n    }\n    \n    // New game modal methods\n    showNewGameModal() {\n        // Delegate to UIManager to show the new game modal\n        this.uiManager.showNewGameModal();\n    }\n    \n\n    hideNewGameModal() {\n        this.uiManager.hideNewGameModal();\n    }\n\n    showMainMenu() {\n        this.uiManager.showMainMenu();\n    }\n\n    hideMainMenu() {\n        this.uiManager.hideMainMenu();\n    }\n\n    showPauseMenu() {\n        this.uiManager.showPauseMenu();\n    }\n\n    hidePauseMenu() {\n        this.uiManager.hidePauseMenu();\n    }\n\n    getSaveName() {\n        return this.uiManager.getSaveName();\n    }\n\n    async confirmNewGame() {\n        let saveName = this.uiManager.getSaveName();\n        \n        // Provide a default name if empty\n        if (!saveName) {\n            saveName = 'My Game';\n        }\n        \n        // Store the save name in the game state\n        if (!this.gameState) this.gameState = {};\n        this.gameState.saveName = saveName;\n        \n        logger.log(`Starting new game with save name: ${saveName}`);\n        this.hideNewGameModal();\n        \n        try {\n            // Make sure WebAssembly is loaded\n            if (!window.Module) {\n                logger.error('WebAssembly module not loaded');\n                return;\n            }\n            \n            // Initialize the game state with the save name\n            logger.log('Initializing game state...');\n            \n            // Show the game container and hide the main menu and pause menu using uiManager\n            this.uiManager.hideNewGameModal();\n            this.uiManager.hideMainMenu();\n            this.uiManager.hidePauseMenu();\n            \n            // Show the game container\n            const gameContainer = this.uiManager.elements.gameContainer;\n            if (gameContainer) gameContainer.classList.remove('hidden');\n            \n            // Reset the simulation with the save name\n            await this.resetSimulation(saveName);\n            \n            // Start the simulation and wait for it to complete\n            this.isRunning = true;\n            this.isPaused = false;\n            await this.startSimulation();\n            \n            logger.log('New game started successfully');\n            \n        } catch (error) {\n            logger.error('Failed to start new game:', error);\n            throw error;\n        }\n    }\n    \n    async startNewGame() {\n        this.showNewGameModal();\n    }\n    \n    async loadWasm() {\n        logger.log('Loading WebAssembly module...');\n        \n        try {\n            // Check if the WebAssembly module is already loaded and initialized\n            if (window.Module && window.Module.asm) {\n                logger.log('WebAssembly module already loaded and initialized');\n                return true;\n            }\n            \n            // If Module exists but not initialized, wait for initialization\n            if (window.Module && !window.wasmReady) {\n                logger.log('WebAssembly module loaded but not yet initialized, waiting...');\n                await this.waitForWasmReady();\n                return true;\n            }\n            \n            // If we get here, the Module might not be loaded at all\n            if (!window.Module) {\n                // Try to trigger the WebAssembly loading if it hasn't started\n                if (window.loadWasmScript && typeof window.loadWasmScript === 'function') {\n                    logger.log('Manually triggering WebAssembly script load...');\n                    window.loadWasmScript();\n                } else {\n                    throw new Error('WebAssembly module loader not found');\n                }\n            }\n            \n            // Wait for the WebAssembly module to be ready\n            await this.waitForWasmReady();\n            \n            // Final check to make sure everything is loaded\n            if (!window.Module || !window.Module.asm) {\n                throw new Error('WebAssembly module failed to initialize');\n            }\n            \n            logger.log('WebAssembly module loaded and initialized successfully');\n            \n            // Log available functions for debugging\n            const moduleFunctions = Object.keys(window.Module).filter(k => \n                typeof window.Module[k] === 'function' && \n                !k.startsWith('_emscripten_')\n            );\n            logger.log('Available Module functions:', moduleFunctions);\n            \n            if (window.Module.asm) {\n                const asmFunctions = Object.keys(window.Module.asm).filter(\n                    k => typeof window.Module.asm[k] === 'function'\n                );\n                logger.log('Available Module.asm functions:', asmFunctions);\n            }\n            \n            return true;\n            \n        } catch (error) {\n            logger.error('Failed to load WebAssembly module:', error);\n            \n            // Additional debug information\n            if (window.Module) {\n                logger.error('Module state on error:', {\n                    status: window.Module.status,\n                    error: window.Module.error,\n                    ready: window.Module.asm ? 'Module.asm exists' : 'Module.asm is undefined'\n                });\n            } else {\n                logger.error('window.Module is not defined');\n            }\n            \n            throw error;\n        }\n    }\n\n    /**\n     * Shows the new game modal to get the save name\n     */\n    startNewGame() {\n        logger.log('Showing new game modal...');\n        this.uiManager.showNewGameModal();\n    }\n\n    /**\n     * Shows the save manager modal with a list of saved games\n     */\n    showSaveManager() {\n        this.uiManager.showSaveManager();\n    }\n    \n    /**\n     * Hides the save manager modal\n     */\n    hideSaveManager() {\n        this.uiManager.hideSaveManager();\n    }\n    \n    /**\n     * Refreshes the list of saved games in the save manager modal\n     */\n    refreshSaveList() {\n        this.uiManager.refreshSaveList();\n    }\n\n    \n    /**\n     * Loads a saved game\n     * @param {string} saveId - The ID of the save to load\n     */\n    async loadGame(saveId) {\n        logger.log(`Loading game with ID: ${saveId}`);\n        \n        try {\n            // Load the saved game state\n            const savedState = saveManager.loadGame(saveId);\n            \n            if (!savedState) {\n                logger.error('Failed to load saved game: Invalid save data');\n                this.uiManager.showNotification('Failed to load saved game. The save file may be corrupted.');\n                return;\n            }\n            \n            // Hide the save manager modal and main menu\n            this.hideSaveManager();\n            this.hideMainMenu();\n            \n            // Show the game container\n            if (this.uiManager.elements.gameContainer) {\n                this.uiManager.elements.gameContainer.classList.remove('hidden');\n            }\n            \n            // Reset the simulation with the loaded state\n            await this.resetSimulation(savedState.saveName || 'Loaded Game');\n            \n            // Apply the loaded game state, making sure to preserve the saveId and saveName\n            this.gameState = { \n                ...this.gameState, \n                ...savedState,\n                // Ensure saveId and saveName are preserved from the loaded state\n                saveId: savedState.saveId || savedState.id, // Handle both formats for backward compatibility\n                saveName: savedState.saveName || savedState.name || 'Loaded Game'\n            };\n            \n            logger.log('Game state after loading:', {\n                saveId: this.gameState.saveId,\n                saveName: this.gameState.saveName,\n                hasGameState: !!this.gameState\n            });\n            \n            // Start the simulation\n            this.isRunning = true;\n            this.isPaused = false;\n            \n            // Hide the pause menu if it's visible\n            this.uiManager.hidePauseMenu();\n            \n            // Start the simulation\n            await this.startSimulation();\n            \n            logger.log('Game loaded successfully');\n            this.uiManager.showNotification('Game loaded successfully!');\n            \n        } catch (error) {\n            logger.error('Error loading game:', error);\n            this.uiManager.showNotification('An error occurred while loading the game. Please check the console for details.');\n            \n            // If loading fails, make sure to show the main menu\n            this.uiManager.showMainMenu();\n        }\n    }\n\n    showSettings() {\n        logger.log('Showing settings...');\n        // Implementation for showing settings\n    }\n\n    async startSimulation() {\n        if (!window.Module) {\n            const error = new Error('WebAssembly module not loaded');\n            logger.error(error.message);\n            throw error;\n        }\n        \n        try {\n            // Log available Module functions for debugging\n            const moduleFunctions = Object.keys(window.Module).filter(k => \n                typeof window.Module[k] === 'function' && \n                !k.startsWith('_emscripten_')\n            );\n            logger.log('Available Module functions:', moduleFunctions);\n            \n            // Initialize the simulation grid\n            await this.initializeSimulationGrid();\n            \n            // Check for initialization functions in different locations\n            let initFunc = null;\n            \n            // Check in Module.asm first\n            if (window.Module.asm) {\n                if (typeof window.Module.asm._initialize === 'function') {\n                    initFunc = window.Module.asm._initialize;\n                    logger.log('Found _initialize in Module.asm');\n                } else if (typeof window.Module.asm._start === 'function') {\n                    initFunc = window.Module.asm._start;\n                    logger.log('Found _start in Module.asm');\n                } else if (typeof window.Module.asm._main === 'function') {\n                    initFunc = window.Module.asm._main;\n                    logger.log('Found _main in Module.asm');\n                }\n            }\n            \n            // If not found in Module.asm, check in Module\n            if (!initFunc) {\n                if (typeof window.Module._initialize === 'function') {\n                    initFunc = window.Module._initialize;\n                    logger.log('Found _initialize in Module');\n                } else if (typeof window.Module._start === 'function') {\n                    initFunc = window.Module._start;\n                    logger.log('Found _start in Module');\n                } else if (typeof window.Module._main === 'function') {\n                    initFunc = window.Module._main;\n                    logger.log('Found _main in Module');\n                }\n            }\n            \n            // If we found an initialization function, call it\n            if (initFunc) {\n                logger.log('Initializing simulation...');\n                initFunc();\n                this.isRunning = true;\n                \n                // Update UI if elements exist\n                const { startBtn, pauseBtn } = this.elements;\n                if (startBtn) startBtn.disabled = true;\n                if (pauseBtn) pauseBtn.disabled = false;\n                \n                logger.log('Simulation started successfully', 'success');\n                return;\n            }\n            \n            // If no initialization function was found, set up our own render loop\n            logger.log('No initialization function found, setting up render loop...');\n            \n            // Set simulation state\n            this.isRunning = true;\n            this.isPaused = false;\n            this.lastRenderTime = null;\n            \n            // Start the render loop\n            this.currentMainLoop = requestAnimationFrame(this.render.bind(this));\n            \n            // Update UI if elements exist\n            const { startBtn, pauseBtn } = this.uiManager.elements || {};\n            if (startBtn) startBtn.disabled = true;\n            if (pauseBtn) pauseBtn.disabled = false;\n            \n            logger.log('Render loop started');\n        } catch (error) {\n            logger.error('Error starting simulation:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Toggles the pause state of the simulation\n     */\n    togglePause() {\n        if (!this.isRunning) return;\n        \n        this.isPaused = !this.isPaused;\n        \n        if (this.isPaused) {\n            // Pause the simulation\n            if (window.Module) {\n                if (typeof window.Module._emscripten_pause_main_loop === 'function') {\n                    window.Module._emscripten_pause_main_loop();\n                } else if (window.Module.asm && window.Module.asm._emscripten_pause_main_loop) {\n                    window.Module.asm._emscripten_pause_main_loop();\n                }\n            }\n            \n            // Show pause menu using uiManager\n            this.uiManager.showPauseMenu();\n            \n            logger.log('Simulation paused');\n        } else {\n            this.resumeSimulation();\n        }\n    }\n\n    /**\n     * Resumes the simulation from a paused state\n     */\n    resumeSimulation() {\n        if (window.Module) {\n            if (typeof window.Module._emscripten_resume_main_loop === 'function') {\n                window.Module._emscripten_resume_main_loop();\n            } else if (window.Module.asm && window.Module.asm._emscripten_resume_main_loop) {\n                window.Module.asm._emscripten_resume_main_loop();\n            }\n        }\n        \n        // Hide pause menu using uiManager\n        this.uiManager.hidePauseMenu();\n        \n        this.isPaused = false;\n        logger.log('Simulation resumed');\n    }\n\n    /**\n     * Handles the Resume button click in the pause menu\n     */\n    onResumeClick() {\n        this.resumeSimulation();\n    }\n\n    /**\n     * Handles the Save Game button click in the pause menu\n     */\n    /**\n     * Handles the Save & Quit button click in the pause menu\n     */\n    async onSaveAndQuitClick() {\n        logger.log('Save & Quit clicked');\n        \n        try {\n            // First save the game\n            await this.onSaveGameClick();\n            \n            // Small delay to show the save notification\n            await new Promise(resolve => setTimeout(resolve, 500));\n            \n            // Then quit to menu\n            this.onQuitToMenuClick();\n        } catch (error) {\n            logger.error('Error during save & quit:', error);\n            this.uiManager.showNotification('Error saving game. Changes may not be saved.');\n        }\n    }\n    \n    /**\n     * Handles the Save Game button click in the pause menu\n     */\n    onSaveGameClick() {\n        logger.log('Saving game...');\n        \n        // Check if we have a game state\n        if (!this.gameState) {\n            logger.error('No active game state to save');\n            this.uiManager.showNotification('Error: No active game to save');\n            return Promise.reject('No active game state');\n        }\n        \n        try {\n            // Create a simplified game state for saving\n            const gameState = {\n                turnCount: this.gameState.turnCount || 0,\n                // Include other game state properties as needed\n                ...this.gameState\n            };\n            \n            // Check if this is an existing game with a save ID\n            const saveId = this.gameState.saveId;\n            const saveName = this.gameState.saveName || `Game ${new Date().toLocaleString()}`;\n            \n            if (saveId) {\n                // Update existing save\n                const updatedSave = saveManager.saveGame(gameState, saveName, saveId);\n                if (updatedSave) {\n                    logger.log('Game updated successfully:', updatedSave);\n                    this.uiManager.showNotification('Game saved successfully!');\n                    return Promise.resolve(updatedSave);\n                } else {\n                    throw new Error('Failed to update save');\n                }\n            } else {\n                // Create a new save with the current game name or a default name\n                const newSave = saveManager.saveGame(gameState, saveName);\n                if (newSave) {\n                    // Store the save ID and name for future updates\n                    this.gameState.saveId = newSave.id;\n                    this.gameState.saveName = saveName; // Ensure name is stored for future saves\n                    logger.log('New game saved:', newSave);\n                    this.uiManager.showNotification('New game saved successfully!');\n                    return Promise.resolve(newSave);\n                } else {\n                    throw new Error('Failed to create new save');\n                }\n            }\n        } catch (error) {\n            logger.error('Error saving game:', error);\n            this.uiManager.showNotification('Error saving game: ' + (error.message || 'Unknown error'));\n            return Promise.reject(error);\n        }\n    }\n    \n    // Notification functionality has been moved to UIManager\n    // Use this.uiManager.showNotification() instead\n    \n    async onQuitToMenuClick() {\n        try {\n            logger.log('Quitting to main menu...');\n            \n            // Stop any running simulation\n            if (this.currentMainLoop) {\n                window.cancelAnimationFrame(this.currentMainLoop);\n                this.currentMainLoop = null;\n            }\n            \n            // Reset game state\n            this.isRunning = false;\n            this.isPaused = false;\n            \n            // Show main menu and hide game container using uiManager\n            this.uiManager.showMainMenu();\n            \n            // Hide the game container\n            if (this.uiManager.elements.gameContainer) {\n                this.uiManager.elements.gameContainer.classList.add('hidden');\n            }\n            \n            // Reset states\n            this.isRunning = false;\n            this.isPaused = false;\n            \n            logger.log('Successfully returned to main menu');\n        } catch (error) {\n            logger.error('Error during quit to menu:', error);\n            throw error;\n        }\n    }\n\n    /**\n     * Initializes the simulation grid based on the canvas size\n     */\n    async initializeSimulationGrid() {\n        logger.log('Initializing simulation grid...');\n        \n        try {\n            const canvas = document.querySelector('canvas');\n            if (!canvas) {\n                throw new Error('Canvas element not found');\n            }\n            \n            // Set canvas to full window size\n            canvas.width = window.innerWidth;\n            canvas.height = window.innerHeight;\n            \n            // Define grid properties\n            const cellSize = 20; // Size of each grid cell in pixels\n            const width = Math.ceil(canvas.width / cellSize);\n            const height = Math.ceil(canvas.height / cellSize);\n            \n            this.grid = {\n                cellSize,\n                width,\n                height,\n                cells: []\n            };\n            \n            // Initialize temperature system\n            await this.temperatureManager.initialize(width, height, 20);\n            \n            // Initialize selection manager\n            this.selectionManager.init(canvas, cellSize);\n            \n            // Initialize grid cells\n            for (let y = 0; y < height; y++) {\n                const row = [];\n                for (let x = 0; x < width; x++) {\n                    const temp = this.temperatureManager.getTemperature(x, y);\n                    row.push({\n                        x,\n                        y,\n                        type: 'empty',\n                        energy: 0,\n                        creature: null,\n                        temperature: temp,\n                        lastTempUpdate: 0\n                    });\n                }\n                this.grid.cells.push(row);\n            }\n            \n            logger.log(`Initialized grid: ${width}x${height} (${cellSize}px cells)`);\n            \n        } catch (error) {\n            logger.error('Failed to initialize simulation grid:', error);\n            throw error;\n        }\n    }\n    \n    /**\n     * Toggles temperature visualization on/off\n     */\n    \n    /**\n     * Gets a color for a temperature value\n     * @param {number} temp - Temperature value\n     * @returns {string} CSS color string\n     */\n    getTemperatureColor(temp) {\n        const { minTemp, maxTemp } = this.temperatureSettings || { minTemp: 0, maxTemp: 100 };\n        \n        // Normalize temperature to 0-1 range\n        const range = maxTemp - minTemp;\n        let t = range !== 0 ? (temp - minTemp) / range : 0.5;\n        t = Math.max(0, Math.min(1, t)); // Clamp to 0-1\n        \n        // Create gradient from blue (cold) to red (hot)\n        const r = Math.round(t * 255);\n        const b = Math.round((1 - t) * 255);\n        \n        return `rgb(${r}, 0, ${b})`;\n    }\n\n    /**\n     * Handles keyboard input\n     * @param {KeyboardEvent} event - The keyboard event\n     */\n    handleKeyDown(event) {\n        // Toggle temperature view with 't' key\n        if (event.key.toLowerCase() === 't') {\n            this.showTemperature = !this.showTemperature;\n            \n            // Update tooltip for hovered cell if selectionManager is available\n            if (this.selectionManager && typeof this.selectionManager.getHoveredCell === 'function') {\n                const hoveredCell = this.selectionManager.getHoveredCell();\n                if (hoveredCell && this.temperatureManager) {\n                    const temp = this.temperatureManager.getTemperature(hoveredCell.x, hoveredCell.y);\n                    if (this.selectionManager.updateTooltip) {\n                        this.selectionManager.updateTooltip(temp);\n                    }\n                }\n            }\n            \n            // Prevent default and stop propagation\n            event.preventDefault();\n            event.stopPropagation();\n            return false;\n        }\n    }\n    \n    /**\n     * Draws the simulation grid\n     * @param {CanvasRenderingContext2D} [ctx] - Optional canvas 2D context\n     * @param {number} [width] - Optional canvas width\n     * @param {number} [height] - Optional canvas height\n     */\n    async drawGrid(ctx, width, height) {\n        try {\n            // If no context is provided, get it from the canvas\n            if (!ctx) {\n                const canvas = document.querySelector('canvas');\n                if (!canvas) return false;\n                \n                ctx = canvas.getContext('2d');\n                if (!ctx) return false;\n                \n                width = width || canvas.width;\n                height = height || canvas.height;\n                \n                // Clear the canvas\n                ctx.clearRect(0, 0, width, height);\n            }\n            \n            // Set grid style\n            const cellSize = this.grid?.cellSize || 20;\n            ctx.strokeStyle = this.grid ? '#1a1a1a' : '#333333';\n            ctx.lineWidth = this.grid ? 1 : 0.5;\n            \n            // Draw vertical grid lines\n            for (let x = 0; x <= width; x += cellSize) {\n                ctx.beginPath();\n                ctx.moveTo(x, 0);\n                ctx.lineTo(x, height);\n                ctx.stroke();\n            }\n            \n            // Draw horizontal grid lines\n            for (let y = 0; y <= height; y += cellSize) {\n                ctx.beginPath();\n                ctx.moveTo(0, y);\n                ctx.lineTo(width, y);\n                ctx.stroke();\n            }\n            \n            return true;\n            \n        } catch (error) {\n            logger.error('Error drawing grid:', error);\n            throw error;\n        }\n    }\n    \n    /**\n     * Resets the simulation to its initial state\n     * @param {string} [saveName='My Game'] - Name of the save file\n     * @returns {Promise<boolean>} True if reset was successful\n     */\n    async resetSimulation(saveName = 'My Game') {\n        try {\n            logger.log(`Resetting simulation with save name: ${saveName}`);\n            \n            // Stop any running simulation\n            if (this.currentMainLoop) {\n                window.cancelAnimationFrame(this.currentMainLoop);\n                this.currentMainLoop = null;\n            }\n            \n            // Reset game state\n            this.gameState = {\n                isRunning: false,\n                isPaused: false,\n                saveName: saveName,\n                createdAt: new Date().toISOString(),\n                lastSaved: null\n            };\n            \n            // Reinitialize the grid\n            await this.initializeSimulationGrid();\n            \n            logger.log('Simulation reset successfully', 'info');\n            return true;\n            \n        } catch (error) {\n            logger.error('Failed to reset simulation:', error);\n            throw error;\n        }\n    }\n}\n\n// Export a singleton instance\nexport const app = new App();\n","import { app } from './modules/app.js';\n\n// Global error handler\nwindow.addEventListener('error', (event) => {\n    console.error('Global error:', event.error || event.message);\n    if (window.app && window.app.logger) {\n        window.app.logger.error('Global error:', event.error || event.message);\n    }\n});\n\n// Handle unhandled promise rejections\nwindow.addEventListener('unhandledrejection', (event) => {\n    console.error('Unhandled promise rejection:', event.reason);\n    if (window.app && window.app.logger) {\n        window.app.logger.error('Unhandled promise rejection:', event.reason);\n    }\n});\n\n// Initialize the application when the DOM is loaded\nfunction initApp() {\n    try {\n        // Make app available globally for debugging and WebAssembly callbacks\n        window.app = app;\n        \n        // Initialize the app\n        app.initialize();\n        \n        // Handle WebAssembly ready event\n        window.addEventListener('wasm-ready', () => {\n            console.log('WASM ready event received');\n            if (typeof app.onWasmReady === 'function') {\n                app.onWasmReady();\n            }\n        });\n        \n        // Handle WebAssembly errors\n        window.addEventListener('wasm-error', (event) => {\n            console.error('WASM error:', event.detail);\n            if (app.logger) {\n                app.logger.error('Failed to load WebAssembly:', event.detail);\n            }\n            \n            // Show error in the UI if possible\n            const statusEl = document.getElementById('status');\n            if (statusEl) {\n                statusEl.textContent = `Error: ${event.detail || 'Failed to load WebAssembly'}`;\n                statusEl.style.color = 'red';\n                statusEl.className = 'status error';\n            }\n        });\n        \n        // Check if WebAssembly is already loaded\n        if (window.wasmReady && typeof app.onWasmReady === 'function') {\n            console.log('WebAssembly already loaded, initializing app...');\n            app.onWasmReady();\n        }\n    } catch (error) {\n        console.error('Failed to initialize application:', error);\n        // Show error in the UI if possible\n        const statusEl = document.getElementById('status');\n        if (statusEl) {\n            statusEl.textContent = `Error: ${error.message || 'Failed to initialize application'}`;\n            statusEl.style.color = 'red';\n            statusEl.className = 'status error';\n        }\n    }\n}\n\n// Start the app when the DOM is fully loaded\nif (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', initApp);\n} else {\n    // DOMContentLoaded has already fired\n    initApp();\n}\n"],"names":["Logger","error","level","args","message","arg","e","logElement","now","logEntry","time","msg","event","type","messageStr","logger","SaveManager","savesJson","save","a","b","id","gameState","name","updates","saveIndex","updatedSave","initialLength","saveId","jsonString","merge","importedSaves","existingSaves","saveManager","UIManager","app","cellInfo","delta","infoText","newGameModal","newGameBtn","loadGameBtn","settingsBtn","resumeBtn","saveGameBtn","saveQuitBtn","settingsMenuBtn","quitToMenuBtn","closeNewGameBtn","cancelNewGameBtn","confirmNewGameBtn","saveNameInput","el","onConfirm","confirmationModal","confirmBtn","cancelBtn","closeBtn","hideModal","cancelHandler","handleKeyDown","saveManagerModal","savesList","saves","noSaves","saveItem","formattedDate","loadBtn","deleteBtn","errorMsg","duration","notification","resolve","SelectionManager","canvas","cellSize","tooltip","isRightButtonDown","rect","x","y","cellX","cellY","cell","centerX","centerY","cells","radius","radiusSq","isRightClick","isDraggingWithRightButton","mouseUpEvent","temperature","ctx","selectionManager","JsTemperatureSystem","width","height","ambientTemp","maxDist","row","dx","dy","dist","temp","deltaTime","neighbors","dirs","nx","ny","diff","acc","n","result","TemperatureManager","range","c","nextRange","rangeMin","rangeMax","factor","g","showTemperature","tempData","temperatureManager","App","isDecrease","newTemp","timestamp","hoveredCell","selectedCell","data","command","key","value","adminState","reject","timeout","onWasmReady","checkReady","saveName","gameContainer","moduleFunctions","k","asmFunctions","savedState","initFunc","startBtn","pauseBtn","newSave","minTemp","maxTemp","t","r","initApp","statusEl"],"mappings":"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"}